modules:
  - type: containerfile
    snippets:
      - COPY --from=ghcr.io/ublue-os/akmods:main-42 /rpms /tmp/rpms
      - COPY --from=ghcr.io/ublue-os/akmods:main-42 /kernel-rpms /tmp/rpms/kernel
      - RUN find /tmp/rpms
      - RUN rpm -q ublue-os-akmods-addons || rpm-ostree install /tmp/rpms/ublue-os/ublue-os-akmods-addons*.rpm
  
  - type: script
    scripts:
      - installsignedkernel.sh

  - type: dnf
    install:
      packages:
        - just
        - powerstat

  - type: dnf
    repos:
      copr:
        - ublue-os/packages
    install:
      packages:
        - ublue-os-udev-rules
        - ublue-os-update-services
        - ublue-os-signing
        - ublue-os-luks
        - ublue-os-just
        - ublue-brew
        - ublue-os-libvirt-workarounds
        - bazaar

  - type: script
    scripts:
      - installandroidudev.sh
      - ensureautoupdates.sh
      - fixupstreamicdloaderbug.sh

  - type: dnf
    remove:
      packages:
        - default-fonts-cjk-sans
        - google-noto-sans-cjk-vf-fonts
        - firefox
        - firefox-langpacks
        - fedora-logos
        - fedora-chromium-config
        - fedora-chromium-config-gnome
        - fedora-flathub-remote
    optfix:
      - zen
    repos:
      files:
        - https://repo.secureblue.dev/secureblue.repo
      copr:
        - sneexy/zen-browser
        - secureblue/trivalent
        - scottames/ghostty
        - lihaohong/yazi
    install:
      allow-erasing: true
      install-weak-deps: false
      packages:
        - sassc
        - gtk-murrine-engine
        - qt5-qtwayland
        - qt6-qtwayland 
        - fzf
        - micro
        - polkit
        - zen-browser
        - ghostty
        - distrobox
        - greetd
        - tuigreet
        - greetd-selinux
        - trivalent
        - trivalent-subresource-filter
        - vim
        - neovim
        - python3-neovim
        - git
        - ripgrep
        - lsd
        - bat
        - fd-find
        # Network
        - openssl
        - network-manager-applet
        - NetworkManager-openvpn
        - NetworkManager-openvpn-gnome
        - NetworkManager-openconnect
        - NetworkManager-openconnect-gnome
        - firewall-config
        - fprintd-pam
        # Audio
        - pavucontrol
        - wireplumber
        - pipewire
        - pamixer
        - pulseaudio-utils
        # System
        - dbus-tools
        - xdg-user-dirs
        - dbus-daemon
        # File Manager
        - yazi
        # Multimedia
        - gstreamer1-plugin-vaapi
        - gstreamer1-plugin-libav
        - gstreamer1-plugins-bad-free-extras
        - gstreamer1-plugins-bad-freeworld
        - gstreamer1-plugins-ugly
        - gstreamer1-vaapi
        - libheif
        - libheif-freeworld
        # Graphics
        - vulkan-validation-layers
        - vulkan-tools
        # Container
        - podman-compose
        - podman-tui
        - podmansh
        - docker-ce
        - docker-ce-cli
        - docker-buildx-plugin
        - docker-compose-plugin
        - containerd.io
        # Virtualization
        - qemu-char-spice
        - qemu-device-display-virtio-gpu
        - qemu-device-display-virtio-vga
        - qemu-device-usb-redirect
        - qemu-img
        - qemu-system-x86-core
        - qemu-user-binfmt
        - qemu-user-static
        - qemu
        - virt-manager
        - libvirt
        - libvirt-nss
        # Util
        - p7zip
        # Shell
        - zsh

  - type: fonts
    fonts:
      nerd-fonts:
        - FiraCode
        - JetBrainsMono
        - NerdFontsSymbolsOnly
      google-fonts:
        - Roboto
        - Open Sans
          
  - type: script
    scripts:
      - installproprietarypackages.sh

  - type: dnf
    install:
      packages:
        - heif-pixbuf-loader
        - ffmpeg
        - ffmpeg-libs
        - ffmpegthumbnailer
        - pipewire-libs-extra
        - libfdk-aac
        - gstreamer1-plugins-ugly
    remove:
      packages:
        - gstreamer1-plugins-ugly-free
        - fdk-aac-free
        - ffmpeg-free
        - libavcodec-free
        - libavdevice-free
        - libavfilter-free
        - libavformat-free
        - libavutil-free
        - libpostproc-free
        - libswresample-free
        - libswscale-free

  - type: script
    scripts:
      - installrpmfusion.sh
      - removeunusedrepos.sh

  - type: files
    files:
      - source: system/usr
        destination: /usr
      - source: system/etc
        destination: /etc

  - type: script
    scripts:
      - settheming.sh

  - type: gschema-overrides
    include:
      - bluewalk-theming.gschema.override

  - type: script
    scripts:
      - addbrewjustimport.sh

  - type: signing
