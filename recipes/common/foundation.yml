modules:
  - type: containerfile
    snippets:
      - COPY --from=ghcr.io/ublue-os/akmods:main-42 /rpms /tmp/rpms
      - COPY --from=ghcr.io/ublue-os/akmods:main-42 /kernel-rpms /tmp/rpms/kernel
      - RUN find /tmp/rpms
      - RUN rpm -q ublue-os-akmods-addons || rpm-ostree install /tmp/rpms/ublue-os/ublue-os-akmods-addons*.rpm
  
  - type: script
    scripts:
      - installsignedkernel.sh

  - type: dnf
    install:
      packages:
        - just
        - powerstat

  - type: dnf
    repos:
      copr:
        - ublue-os/packages
    install:
      packages:
        - ublue-os-udev-rules
        - ublue-os-update-services
        - ublue-os-signing
        - ublue-os-luks
        - ublue-os-just
        - ublue-brew
        - ublue-os-libvirt-workarounds
        - bazaar

  - type: script
    scripts:
      - installandroidudev.sh
      - ensureautoupdates.sh
      - fixupstreamicdloaderbug.sh
      - addimageinfo.sh

  - type: dnf
    remove:
      packages:
        - default-fonts-cjk-sans
        - google-noto-sans-cjk-vf-fonts
        - firefox
        - firefox-langpacks
        - fedora-logos
        - fedora-chromium-config
        - fedora-flathub-remote
    optfix:
      - zen
    repos:
      files:
        - https://repo.secureblue.dev/secureblue.repo
        - https://download.docker.com/linux/fedora/docker-ce.repo
      copr:
        - sneexy/zen-browser
        - secureblue/trivalent
        - scottames/ghostty
        - lihaohong/yazi
        - che/zed
    install:
      allow-erasing: true
      install-weak-deps: false
      packages:
        # Browsers
        - trivalent
        - trivalent-subresource-filter
        - zen-browser
        # Terminal
        - ghostty
        # Shell
        - zsh
        # Editor
        - vim
        - neovim
        - tree-sitter-cli
        - python3-neovim
        - zed
        # Greeter 
        - greetd
        - tuigreet
        - greetd-selinux
        # Network
        - openssl
        - network-manager-applet
        - NetworkManager-openvpn
        - NetworkManager-openconnect
        - firewall-config
        - fprintd-pam
        # Audio
        - pavucontrol
        - pamixer
        # Video
        - mpv
        - mpv-libs
        # System
        - dbus-tools
        - xdg-user-dirs
        - dbus-daemon
        - zstd
        # File Managers
        - nautilus
        - yazi
        # Graphics
        - vulkan-validation-layers
        - vulkan-tools
        # Container
        - distrobox
        - podman-compose
        - podman-tui
        - podmansh
        - docker-ce
        - docker-ce-cli
        - containerd.io
        - docker-buildx-plugin
        - docker-compose-plugin
        # Virtualization
        - qemu-audio-spice
        - qemu-char-spice
        - qemu-device-display-virtio-gpu
        - qemu-device-display-virtio-vga
        - qemu-device-display-qxl
        - qemu-device-usb-redirect
        - qemu-img
        - qemu-system-x86-core
        - qemu-user-binfmt
        - qemu-user-static
        - qemu
        - virt-manager
        - libvirt
        - libvirt-nss
        - libvirt-daemon-driver-network
        - libvirt-daemon-driver-nodedev 
        - libvirt-daemon-driver-qemu 
        - libvirt-daemon-driver-storage-core 
        # Util
        - fzf
        - fastfetch
        - p7zip
        - syncthing
        - git
        - ripgrep
        - lsd
        - bat
        - fd-find
        - sassc
        - gtk-murrine-engine
        - qt5ct 
        - qt6ct
        - playerctl
        - mako
        - mediainfo
        - alsa-firmware
        - ddcutil

  - type: fonts
    fonts:
      nerd-fonts:
        - FiraCode
        - JetBrainsMono
        - NerdFontsSymbolsOnly
      google-fonts:
        - Roboto
        - Open Sans
        - InterVariable
  - type: script
    scripts:
      - installproprietarypackages.sh

  - type: dnf
    install:
      packages:
        - heif-pixbuf-loader
        - ffmpeg
        - ffmpeg-libs
        - ffmpegthumbnailer
        - pipewire-libs-extra
        - libfdk-aac
        - gstreamer1-plugins-ugly
    remove:
      packages:
        - gstreamer1-plugins-ugly-free
        - fdk-aac-free
        - ffmpeg-free
        - libavcodec-free
        - libavdevice-free
        - libavfilter-free
        - libavformat-free
        - libavutil-free
        - libpostproc-free
        - libswresample-free
        - libswscale-free

  - type: script
    scripts:
      - installrpmfusion.sh
      - removeunusedrepos.sh

  - type: files
    files:
      - source: system/usr
        destination: /usr
      - source: system/etc
        destination: /etc

  - type: script
    scripts:
      - settheming.sh

  - type: gschema-overrides
    include:
      - bluewalk-theming.gschema.override

  - type: systemd
    system:
      enabled:
        - greetd-boot.service
        - greetd.service
    user:
      enabled:
        - flatpak-setup-gtk-theme.service

  - type: script
    scripts:
      - addbrewjustimport.sh

  - type: signing
