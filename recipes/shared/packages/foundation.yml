modules:
  - type: containerfile
    snippets:
      - COPY --from=ghcr.io/ublue-os/akmods:main-42 /rpms /tmp/rpms
      - COPY --from=ghcr.io/ublue-os/akmods:main-42 /kernel-rpms /tmp/rpms/kernel
      - RUN find /tmp/rpms
      - RUN rpm -q ublue-os-akmods-addons || rpm-ostree install /tmp/rpms/ublue-os/ublue-os-akmods-addons*.rpm
  - type: script
    scripts:
     - installsignedkernel.sh


  - type: dnf
    install:
      packages:
        - just
        - powerstat


  - type: dnf
    repos:
      copr:
        - ublue-os/packages
    install:
      - ublue-os-udev-rules
      - ublue-os-update-services
      - ublue-os-signing
      - ublue-os-luks
      - ublue-os-just
      - ublue-brew
      - ublue-os-libvirt-workarounds

  - type: script
    scripts:
      - installandroidudev.sh
      - ensureautoupdates.sh
      - fixupstreamicdloaderbug.sh

  - type: dnf
    repos:
      nonfree: negativo17
    install:
      packages:
        - libopenjph 
        - repo: fedora-multimedia
          packages:
            - libheif
    replace:
      - from-repo: fedora-multimedia
        packages:
          - libva
          - libva-intel-media-driver
          - intel-gmmlib
          - intel-mediasdk
          - mesa-dri-drivers
          - mesa-filesystem
          - mesa-libEGL
          - mesa-libGL
          - mesa-libgbm
          - mesa-va-drivers
          - mesa-vulkan-drivers




  - type: dnf
    optfix:
      - zen
    repos:
      files:
        - https://repo.secureblue.dev/secureblue.repo
      copr:
        - sneexy/zen-browser
        - secureblue/trivalent
        - scottames/ghostty
        - wef/cliphist
      
    install:
      allow-erasing: true
      install-weak-deps: false
      packages:
        - jetbrains-mono-fonts
        - fira-code-fonts
        - qt5ct
        - qt6ct
        - fzf
        - micro
        - polkit
        - zen-browser
        - ghostty
        - distrobox
        - greetd
        - tuigreet
        - greetd-selinux
        - trivalent
        - trivalent-subresource-filter
        - vim
        - neovim
        - python3-neovim
        # Network
        - openssl
        - network-manager-applet
        - NetworkManager-openvpn
        - NetworkManager-openvpn-gnome
        - NetworkManager-openconnect
        - NetworkManager-openconnect-gnome
        - firewall-config
        - fprintd-pam
        # Audio
        - pavucontrol
        - wireplumber
        - pipewire
        - pamixer
        - pulseaudio-utils
        # System
        - dbus-tools
        - xdg-user-dirs
        - dbus-daemon
        # Multimedia
        - gstreamer1-plugin-vaapi
        - gstreamer1-plugin-libav
        - gstreamer1-plugins-bad-free-extras
        - gstreamer1-plugins-bad-freeworld
        - gstreamer1-plugins-ugly
        - gstreamer1-vaapi
        - libheif
        - libheif-freeworld
        # Graphics
        - vulkan-validation-layers
        - vulkan-tools
        # Container
        - podman-compose
        - podman-tui
        - podmansh
        - docker-ce
        - docker-ce-cli
        - docker-buildx-plugin
        - docker-compose-plugin
        - containerd.io
        # Virtualization
        - qemu-char-spice
        - qemu-device-display-virtio-gpu
        - qemu-device-display-virtio-vga
        - qemu-device-usb-redirect
        - qemu-img
        - qemu-system-x86-core
        - qemu-user-binfmt
        - qemu-user-static
        - qemu
        - virt-manager
        - libvirt
        - libvirt-nss
        # Util
        - p7zip
        # Shell
        - zsh

  - repo: fedora-multimedia
    packages:
            - intel-vaapi-driver
            - libva-utils
            - heif-pixbuf-loader
            - pipewire-libs-extra
    replace:
      - from-repo: fedora-multimedia
        packages:
          - old: ffmpeg-free
            new: ffmpeg
          - old: libfdk-aac-free
            new: libfdk-aac
          - old: libavcodec-free
            new: libavcodec
      # Workaround OpenCL bug
      # https://github.com/ublue-os/main/pull/692
      - from-repo: fedora
        packages:
          - old: OpenCL-ICD-Loader
            new: ocl-icd
  - type: dnf
    install:
      packages:
        - repo: fedora-multimedia
          packages:
            - ffmpeg-libs
    remove:
      - firefox
      - firefox-langpacks
      - fedora-logos
      - fedora-chromium-config
      - fedora-chromium-config-gnome
      - fedora-flathub-remote
      - fedora-third-party
